---
name: review-pr-create-comments
description: 특정 Pull request의 변경사항을 리뷰하고 코멘트를 남기는 스킬
---

해당 스킬은 GitHub CLI 툴인 `gh`를 활용합니다. Context7 MCP를 활용하여 해당 툴에 대해 먼저 학습합니다.

1. 변경사항이 발생하기 이전 기존 프로젝트의 구현 사항을 확인하여, 아키텍처 및 구현 스타일에 대해 파악합니다.
2. 리뷰할 Pull request 번호를 식별합니다. 컨텍스트를 통해 식별할 수 없는 경우 [Pull request 번호 획득](#pull-request-번호-획득) 절차를 진행합니다.
3. PR 타이틀과 본문을 읽고 변경사항의 목적을 파악합니다.
4. 해당 Pull request의 변경사항을 확인합니다. [참조](#pull-request-변경사항-확인)
5. [리뷰 룰](#리뷰-룰)에 따라 리뷰를 진행하고, 코멘트를 생성하여 리스트업합니다. 각 코멘트에는 식별 가능한 index를 부여합니다.
6. 사용자에게 작성할 코멘트에 대해 확인을 요청합니다. [참조](#작성할-코멘트-확인-요청)
7. 선택된 코멘트들을 `gh` 툴을 사용하여 작성합니다. [참조](#코멘트-작성-가이드)

# Pull request 번호 획득

`gh pr list` 명령으로 현재 열려있는 Pull request 목록을 사용자에게 보여줍니다.
사용자로부터 리뷰할 Pull request 번호를 입력받습니다.

# Pull request 변경사항 확인

`gh pr checkout ${PR 번호}` 명령으로 해당 Pull request 브랜치로 전환합니다.
`gh pr diff ${PR_NUMBER}` 명령으로 변경사항을 상세히 확인합니다.

# 리뷰 룰

- Pull request 코멘트는 [P(n)](#pn-룰) 룰을 반드시 준수합니다.
- 의도를 알 수 없는 코드에 대해서 "이건 무슨 의미인가요?"라고 작성하지 않습니다. 어느 정도 이해한 내용과 추측을 작성하고 자신이 이해한 것이 맞는지 확인하는 방식을 사용합니다. "해당 코드의 경우 저는 A라고 생각되긴 하지만, 완벽하게 이해되지 않습니다. 제가 이해한 것이 맞나요?"
- 잘 알려진 디자인 패턴이 아닌 경우 코멘트에 표시하지 않습니다. 예를 들어 "해당 구현의 경우 Box 패턴을 사용할 수 있을 것 같습니다."같은 잘 알려지지 않거나, 해석이 여러 방향으로 가능한 디자인 패턴의 경우 언급하지 않습니다. 적절하다고 생각되는 디자인 패턴을 찾은 경우 코드에 적용한 예시와 함께 상황-행동-결과 형식에 맞춰 제안합니다.
- 문제 제기만 하는 리뷰는 지양합니다. 구체적인 개선사항을 도출하고 제안이 가능한 경우에 대한 코멘트 작성을 지향합니다.

## P(n) 룰

### P1: 꼭 반영해주세요 (Request changes)

리뷰어는 PR의 내용이 서비스에 중대한 오류를 발생할 수 있는 가능성을 잠재하고 있는 등 중대한 코드 수정이 반드시 필요하다고 판단되는 경우, P1 태그를 통해 리뷰 요청자에게 수정을 요청합니다. 리뷰 요청자는 p1 태그에 대해 리뷰어의 요청을 반영하거나, 반영할 수 없는 합리적인 의견을 통해 리뷰어를 설득할 수 있어야 합니다.

#### 예시

```text
p1) 코멘트 본문입니다.
```

### P2: 적극적으로 고려해주세요 (Request changes)

작성자는 P2에 대해 수용하거나 만약 수용할 수 없는 상황이라면 적합한 의견을 들어 토론할 것을 권장합니다.

### P3: 웬만하면 반영해 주세요 (Comment)

작성자는 P3에 대해 수용하거나 만약 수용할 수 없는 상황이라면 반영할 수 없는 이유를 들어 설명하거나 다음에 반영할 계획을 명시적으로(JIRA 티켓 등으로) 표현할 것을 권장합니다. Request changes 가 아닌 Comment 와 함께 사용됩니다.

### P4: 반영해도 좋고 넘어가도 좋습니다 (Approve)

작성자는 P4에 대해서는 아무런 의견을 달지 않고 무시해도 괜찮습니다. 해당 의견을 반영하는 게 좋을지 고민해 보는 정도면 충분합니다.

### P5+: 그냥 사소한 의견입니다 (Approve)

사소한 궁금증에 대한 코멘트입니다.

# 작성할 코멘트 확인 요청

도출한 코멘트들을 리스트업하여 사용자에게 보여줍니다.
사용자는 리스트를 확인하고 최종적으로 Pull request에 코멘트를 작성할 코멘트를 선별합니다.
사용자는 해당 코멘트들의 인덱스를 클로드에게 전달합니다.

# 코멘트 작성 가이드

저장소의 host가 무엇인지 확인합니다. 
코멘트 작성 요청에 실패할 경우 호스트가 잘못 설정되어 있을 가능성이 높습니다.
Claude setting 혹은 컨텍스트를 통해서 호스트를 식별할 수 없는 경우 사용자에게 직접 묻습니다.

아래 명령을 사용하여, 해당 레포지토리의 주인과 이름을 획득합니다.
`gh repo view --json owner,name -q '"\(.owner.login)/\(.name)"'`

## 개별 코멘트 작성

사용자로부터 선택받은 코멘트들을 Pull request에 작성합니다.
전체 코멘트의 body 필드 값으로는 상대방의 수고에 감사하고, 작성한 코멘트에 대한 확인을 정중히 요청하는 텍스트를 전달합니다.

정말 확실한 오류이며 반드시 수정이 필요한 경우 event 값으로 "REQUEST_CHANGES"를 사용합니다.
그 외 대부분의 경우 event 값으로 "COMMENT"를 사용합니다.

예시
```sh
gh api -X POST \
  /repos/{owner}/{repo}/pulls/{pr_number}/reviews \
  --hostname {host} \
  --input - <<'EOF'
{
  "event": "COMMENT",
  "body": "고생하셨습니다👍\n 몇가지 코멘트 남겼습니다! 확인해주시면 감사하겠습니다.",
  "comments": [
    {
      "path": "{file path}",
      "line": {line_number},
      "side": "RIGHT",
      "body": "{comment body}"
    }
  ]
}
EOF
```